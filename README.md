# Создание микросервиса для предсказательной модели

Проект состоит из 4 докер-контейнеров:

1) Первый контейнер features: принимает на вход признаки и целевую переменную, разделяет их, передает признаки в контейнер с моделью и целевую переменную в контейнер для оценки метрик модели;

2) Второй контейнер model: получает входящие признаки, делает предсказание на основе обученной модели и отправляет его в контейнер для оценки метрик модели.

3) Третий контейнер metric: получает целевую переменную из первого котейнера и предсказание из второго контейнера и рассчитывает метрики качества модели. Предсказания, целевая переменная и абсолютная разница между ними записываются в файл [metric/src/logs/metric_log.csv]

4) Четвертый контейнер plot: в режиме бесконечного цикла строит гистограмму ошибок на основе логов из файла logs/metric_log.csv.

Для корректного запуска docker-compose стоит запускать из корневой папки HW1_microservice

Сборка контейнеров: ``` $ docker-compose build ```

Запуск контейнеров: ``` $ docker-compose up -d ```

Отслеживание логов того или иного сервиса: ``` $  docker-compose logs -f plot ```

Остановка контейнеров:  ``` $ docker-compose down ```

### Критерии оценивания

1. Корректная реализация обмена сообщениями через AMQP-протокол (2 балла)

Сервисы работают в режиме бесконечного цикла и обмениваются между собой сообщениями через AMQP-протокол.

2. Введение временной задержки в сервисе features (2 балла) 

В сервисе features предусмотрена временная задержка 30 секунд между итерациями, чтобы можно было отследить последовательную отправку сообщений между сервисами
```
# Задержка
time.sleep(30)
```

3. Присвоение и контроль идентификаторов для сообщений (2 балла)  

Каждое сообщение сопровождается идентификатором, причём этот идентификатор совпадает для признаков, ответов и предсказаний, относящихся к одному и тому же наблюдению из исходной выборки. Это можно увидеть в таблице [metric/src/logs/metric_log.csv](https://github.com/ekaterinakaz4255/HW1_microservice/blob/75a5d55a826d45ec18729b2285402189721a438c/metric/src/logs/metric_log.csv) , где все параметры успешно заносятся с одним идентификатором. 

4. Запись предсказаний, ответов и разницы в файл metriclog.csv (2 балла)  

Предсказания, ответы и абсолютная разница между ними записываются в файл [metric/src/logs/metric_log.csv](https://github.com/ekaterinakaz4255/HW1_microservice/blob/75a5d55a826d45ec18729b2285402189721a438c/metric/src/logs/metric_log.csv) в режиме реального времени. При этом при каждом новом добавлении значения y_true или y_pred отслеживается, присутствуют ли оба параметра, и если да, то рассчитывается абсолютная ошибка, после чего отправляется сообщение сервису plot о новой строке. 

5. Построение гистограммы ошибок (2 балла)

В режиме бесконечного цикла строится гистограмма ошибок на основе логов из файла logs/metric_log.csv. Результат записывается в файл [plot/src/logs/error_distribution.png](https://github.com/ekaterinakaz4255/HW1_microservice/blob/75a5d55a826d45ec18729b2285402189721a438c/plot/src/logs/error_distribution.png)
